generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Menu {
  id           String   @id @default(uuid())
  title        String   @db.VarChar(100)
  checkin      DateTime @db.Date
  checkout     DateTime @db.Date
  adults       Int
  child        Int?     @default(0)
  restrictions String[] @default([])
  preferences  String?  @db.VarChar(500)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  meals        Meal[]
  shoppinglist ShoppingList?

  @@index([createdAt(sort: Desc)])
  @@index([checkin, checkout])
  @@map("menus")
}

model Meal {
  id        String     @id @default(uuid())
  menuId    String     @map("menu_id")
  date      DateTime   @db.Date
  type      TypeOfMeal
  createdAt DateTime   @default(now()) @map("created_at")

  menu   Menu   @relation(fields: [menuId], references: [id], onDelete: Cascade)
  dishes Dish[] @relation("MealDishes")

  @@unique([menuId, date, type])
  @@index([menuId, date])
  @@map("meals")
}

model Dish {
  id        String         @id @default(uuid())
  name      String         @unique @db.VarChar(100)
  category  CategoryOfDish
  createdAt DateTime       @default(now()) @map("created_at")

  ingredients Ingredient[]
  meals       Meal[]       @relation("MealDishes")

  @@index([category])
  @@map("dishes")
}

model Ingredient {
  id       String               @id @default(uuid())
  dishId   String               @map("dish_id")
  name     String               @db.VarChar(100)
  quantify Decimal              @db.Decimal(10, 2)
  unit     String               @db.VarChar(20)
  category CategoryOfIngredient

  dish Dish @relation(fields: [dishId], references: [id], onDelete: Cascade)

  @@index([dishId])
  @@index([category])
  @@map("ingredients")
}

model ShoppingList {
  id        String   @id @default(uuid())
  menuId    String   @unique @map("menu_id")
  itens     Json     @default("[]") @db.JsonB
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  menu Menu @relation(fields: [menuId], references: [id], onDelete: Cascade)

  @@map("shopping_list")
}

enum TypeOfMeal {
  BREAKFAST
  LUNCH
  DESERT
  SNACK
  DINNER
}

enum CategoryOfDish {
  BREAKFAST
  LUNCH
  DESERT
  SNACK
  DINNER
}

enum CategoryOfIngredient {
  PRODUCE
  PROTEIN
  DAIRY
  GRAIN
  CEREAL
  MASS
  FARINACEUS
  OIL
  CANNED
  SAUCES
  MORNING
  BAKING
  TEMPERO
  SNACKS
  CANDY
  OUTROS
}
